---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.3
  name: workflows.tinkerbell.org
spec:
  group: tinkerbell.org
  names:
    categories:
    - tinkerbell
    kind: Workflow
    listKind: WorkflowList
    plural: workflows
    shortNames:
    - bp
    singular: workflow
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        description: |-
          Workflow defines a set of Actions to be run by an Agent. The Workflow is rendered
          prior to execution where it is exposed to Hardware and user defined data. Most fields within the
          WorkflowSpec may contain template values excluding .Workflow.Spec.Actions[].Name.
          See https://pkg.go.dev/text/template for more details.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              actions:
                description: |-
                  Actions defines the set of Actions to be run by an Agent. Actions are run sequentially
                  in the order they are specified. At least 1 Action must be specified. Names of Actions
                  must be unique within a Workflow.
                items:
                  description: Action defines an individual Action to be run on a
                    target machine.
                  properties:
                    args:
                      description: Args are a set of arguments to be passed to the
                        command executed by the container on launch.
                      items:
                        type: string
                      type: array
                    background:
                      description: Background true will run the container in the background
                        or as some runtimes call it detached mode. When set to true,
                        the Agent will immediately report the Action as having succeeded.
                      type: boolean
                    cmd:
                      description: |-
                        Cmd defines the command to use when launching the image. It overrides the default command
                        defined in the Image.
                      type: string
                    env:
                      additionalProperties:
                        type: string
                      description: Env defines environment variables used when launching
                        the container.
                      type: object
                    image:
                      description: Image is fully qualified OCI image name.
                      type: string
                    name:
                      description: Name is a name for the Action.
                      type: string
                    namespaces:
                      description: Namespace defines the Linux namespaces this container
                        should execute in.
                      properties:
                        network:
                          description: Network defines the network namespace.
                          type: string
                        pid:
                          description: PID defines the PID namespace
                          type: string
                      type: object
                    retries:
                      description: Retries defines the number of times the Agent will
                        retry the Action if it fails, not including Timeouts. Retries
                        are only attempted on non-zero exit codes.
                      format: int32
                      type: integer
                    timeout:
                      default: 0
                      description: |-
                        TimeoutSeconds defines the time the Action has to complete. The timer begins when the action is requested.
                        When set to 0, no timeout is applied.
                      format: int64
                      minimum: 0
                      type: integer
                    volumes:
                      description: Volumes defines the volumes to mount into the container.
                      items:
                        description: "Volume is a specification for mounting a volume
                          in an Action. Volumes take the form\n{SRC-VOLUME-NAME |
                          SRC-HOST-DIR}:TGT-CONTAINER-DIR:OPTIONS. When specifying
                          a VOLUME-NAME that\ndoes not exist it will be created for
                          you. Examples:\n\nRead-only bind mount bound to /data\n\n\t/etc/data:/data:ro\n\nWritable
                          volume name bound to /data\n\n\tshared_volume:/data\n\nSee
                          https://docs.docker.com/storage/volumes/ for additional
                          details."
                        type: string
                      type: array
                  required:
                  - image
                  - name
                  type: object
                minItems: 1
                type: array
              env:
                additionalProperties:
                  type: string
                description: |-
                  Env defines environment variables to be available in all Actions. If an Action specifies
                  the same environment variable, the Action's environment variable will take precedence.
                type: object
              logging:
                description: |-
                  Logging defines the logging configuration for all Action containers. If not specified the
                  default runtime configured logging driver is used. This is Agent and runtime specific.
                properties:
                  driver:
                    description: Driver is the logging driver to use for Action containers.
                    type: string
                  options:
                    additionalProperties:
                      type: string
                    description: Options are the logging options to use for Action
                      containers.
                    type: object
                type: object
              volumes:
                description: |-
                  Volumes to be mounted on all Actions. If an Action specifies the same volume it will take
                  precedence.
                items:
                  description: "Volume is a specification for mounting a volume in
                    an Action. Volumes take the form\n{SRC-VOLUME-NAME | SRC-HOST-DIR}:TGT-CONTAINER-DIR:OPTIONS.
                    When specifying a VOLUME-NAME that\ndoes not exist it will be
                    created for you. Examples:\n\nRead-only bind mount bound to /data\n\n\t/etc/data:/data:ro\n\nWritable
                    volume name bound to /data\n\n\tshared_volume:/data\n\nSee https://docs.docker.com/storage/volumes/
                    for additional details."
                  type: string
                type: array
            type: object
        type: object
    served: true
    storage: true
